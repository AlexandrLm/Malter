# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `migration` –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π:
```
ModuleNotFoundError: No module named 'utils'
```

–∏–ª–∏

```
ImportError: cannot import name 'encryption' from 'utils'
```

## –ü—Ä–∏—á–∏–Ω–∞

–í `Dockerfile.migration` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ `utils`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –º–æ–¥—É–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π (encryption, circuit_breaker –∏ —Ç.–¥.).

## –†–µ—à–µ–Ω–∏–µ

### –£–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–û–±–Ω–æ–≤–ª–µ–Ω `Dockerfile.migration`:**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `COPY utils ./utils`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `ENV PYTHONPATH=/app`

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `alembic/env.py`:**
   - –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π
   - –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∏–º–ø–æ—Ä—Ç `from server.models import Base`

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ VDS

### –ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç:

```bash
cd /home/user/evolveai  # –≤–∞—à –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É

# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# 2. –°—Ä–∞–∑—É –∑–∞–ø—É—Å—Ç–∏—Ç—å Docker Compose
docker compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
docker compose logs migration

# –î–æ–ª–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å:
# INFO [alembic.runtime.migration] Running upgrade ... –¥–æ ...
# INFO [alembic.runtime.migration] Done
```

### –ï—Å–ª–∏ —É–∂–µ –∑–∞–ø—É—Å–∫–∞–ª–∏ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä migration —É–ø–∞–ª:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose down

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ migration
docker compose build --no-cache migration

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
docker compose up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -f migration
```

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–±–æ—Ä–∫–∞ (–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç):

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ (–û–ü–ê–°–ù–û - —É–¥–∞–ª–∏—Ç –ë–î!)
docker compose down -v

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã
docker compose build --no-cache

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d

# 5. –ñ–¥–∞—Ç—å –ø–æ–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è
docker compose logs -f migration

# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
# Migration complete!
# service_completed_successfully
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# migration  Exited (0)  - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose logs migration

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏:
# Running upgrade ... to ...
# Done

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"ok"}
```

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏:

```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose logs --tail=200 migration

# –õ–æ–≥–∏ –ë–î
docker compose logs db

# –õ–æ–≥–∏ API (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ë–î)
docker compose logs api
```

–ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
- `ModuleNotFoundError` - –∑–Ω–∞—á–∏—Ç –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∞—Å—å –∫–∞–∫–∞—è-—Ç–æ –ø–∞–ø–∫–∞
- `Connection refused` - –ë–î –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞
- `FATAL: password authentication failed` - –Ω–µ–≤–µ—Ä–Ω—ã–π POSTGRES_PASSWORD –≤ .env

## –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. **Dockerfile.migration**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞: `COPY utils ./utils`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `ENV PYTHONPATH=/app`

2. **alembic/env.py**
   - –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä migration:

1. –ö–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt
3. –ß–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env
4. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL –ë–î
5. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É: `alembic upgrade head`
6. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –ø–∞–ø–∫–∏ alembic/versions/

### –ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

- –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –î–û –∑–∞–ø—É—Å–∫–∞ API –∏ Bot
- –í docker-compose.yml —É–∫–∞–∑–∞–Ω–æ: `depends_on: migration: condition: service_completed_successfully`
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –ë–î –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (–Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ):
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ù–∞ VDS –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
# - docker compose down && docker compose up -d
# - git pull && docker compose restart
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
