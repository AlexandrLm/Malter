# Analytics Dashboard - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìä –û–±–∑–æ—Ä

Analytics Dashboard –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ EvolveAI, –ø–æ–º–æ–≥–∞—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö.

**9 –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö endpoints:**

**–ë–∞–∑–æ–≤—ã–µ:**
- `/admin/analytics/overview` - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/admin/analytics/users` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/admin/analytics/messages` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- `/admin/analytics/revenue` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- `/admin/analytics/features` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ:**
- `/admin/analytics/cohort` - –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (retention)
- `/admin/analytics/funnel` - –í–æ—Ä–æ–Ω–∫–∞ —É—Ä–æ–≤–Ω–µ–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- `/admin/analytics/activity` - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `/admin/analytics/tools` - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ AI Tools

**–í—Å–µ endpoints:**
- ‚úÖ –¢—Ä–µ–±—É—é—Ç JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ö—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5-10 –º–∏–Ω—É—Ç
- ‚úÖ Rate limit: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- ‚ö†Ô∏è –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (TODO)

---

## üéØ 1. Overview - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### Endpoint
```
GET /admin/analytics/overview
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:** total, active (7d), DAU, premium, conversion rate
- **–°–æ–æ–±—â–µ–Ω–∏—è:** total, –∑–∞ 24—á, —Å—Ä–µ–¥–Ω–µ–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Engagement:** —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Ç–Ω–æ—à–µ–Ω–∏–π, retention 7d

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:8000/admin/analytics/overview
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "users": {
      "total": 1250,
      "active_7d": 456,
      "dau": 127,
      "premium": 89,
      "conversion_rate": 7.12
    },
    "messages": {
      "total": 45230,
      "last_24h": 2341,
      "avg_per_user": 36.18
    },
    "engagement": {
      "avg_relationship_level": 4.8,
      "retention_7d": 36.48
    },
    "timestamp": "2025-01-05T19:30:00Z"
  }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **DAU** (Daily Active Users) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ 24 —á–∞—Å–∞
- **Conversion rate** - –ø—Ä–æ—Ü–µ–Ω—Ç premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Retention 7d** - –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–∑ –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞

---

## üë• 2. Users - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### Endpoint
```
GET /admin/analytics/users
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º –æ—Ç–Ω–æ—à–µ–Ω–∏–π (1-14)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º (free/premium)
- –¢–æ–ø-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ 7 –¥–Ω–µ–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "levels_distribution": {
      "level_1": 234,
      "level_2": 189,
      "level_3": 145,
      "level_4": 98,
      "level_5": 67
    },
    "subscription_distribution": {
      "free": 1161,
      "premium": 89
    },
    "top_users": [
      {"user_id": 12345, "messages": 1234},
      {"user_id": 67890, "messages": 987}
    ],
    "new_users_7d": 73,
    "users_with_memory": 456
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- –ü–æ–Ω—è—Ç—å –Ω–∞ –∫–∞–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö "–∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –ù–∞–π—Ç–∏ power users –¥–ª—è feedback
- –û—Ç—Å–ª–µ–¥–∏—Ç—å —Ä–æ—Å—Ç –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üí¨ 3. Messages - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### Endpoint
```
GET /admin/analytics/messages?days=7
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7)

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ –¥–Ω—è–º (—Ç—Ä–µ–Ω–¥)
- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ —á–∞—Å–∞–º (–ø–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ user/model —Å–æ–æ–±—â–µ–Ω–∏–π
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "period_days": 7,
    "total_messages": 15340,
    "messages_by_day": {
      "2025-01-01": 2134,
      "2025-01-02": 2456,
      "2025-01-03": 2198
    },
    "messages_by_hour": {
      "0": 234,
      "1": 189,
      "12": 892,
      "18": 1245,
      "21": 998
    },
    "role_distribution": {
      "user": 7670,
      "model": 7670
    },
    "avg_user_message_length": 87.45
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- **–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –∑–Ω–∞—Ç—å –∫–æ–≥–¥–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å
- **–¢—Ä–µ–Ω–¥:** —Ä–∞—Å—Ç–µ—Ç –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **–î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:** –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

---

## üí∞ 4. Revenue - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫

### Endpoint
```
GET /admin/analytics/revenue
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- –ê–∫—Ç–∏–≤–Ω—ã–µ premium –ø–æ–¥–ø–∏—Å–∫–∏
- –ù–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞ 7 –¥–Ω–µ–π
- –ò—Å—Ç–µ–∫–∞—é—â–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π)
- MRR (Monthly Recurring Revenue)
- ARR (Annual Recurring Revenue)
- Churn rate –∏ Retention rate

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "active_subscriptions": 89,
    "new_subscriptions_7d": 12,
    "expiring_soon_7d": 8,
    "expired_last_month": 5,
    "avg_subscription_days": 28.7,
    "revenue": {
      "mrr": 26611,
      "currency": "RUB",
      "projected_arr": 319332
    },
    "metrics": {
      "churn_rate": 5.32,
      "retention_rate": 94.68
    }
  }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **MRR** - –º–µ—Å—è—á–Ω—ã–π recurring –¥–æ—Ö–æ–¥ (active_subs √ó avg_price)
- **ARR** - –≥–æ–¥–æ–≤–æ–π projected (MRR √ó 12)
- **Churn rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–∞–∑–æ–≤
- **Retention** - –ø—Ä–æ—Ü–µ–Ω—Ç —É–¥–µ—Ä–∂–∞–Ω–∏—è (100 - churn)

### –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **299 RUB/–º–µ—Å—è—Ü** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `analytics.py`)

---

## üîß 5. Features - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### Endpoint
```
GET /admin/analytics/features
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- –í—Å–µ–≥–æ —Ñ–∞–∫—Ç–æ–≤ –≤ –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ø–∞–º—è—Ç—å
- –ü–∞–º—è—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (preferences, family, work, etc.)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–¥–æ–∫ (–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤)

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "memory": {
      "total_facts": 2340,
      "users_using": 456,
      "by_category": {
        "preferences": 890,
        "family": 456,
        "work": 234,
        "hobbies": 189,
        "memories": 345
      }
    },
    "summaries": {
      "total": 234
    }
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- –ü–æ–Ω—è—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ø–∞–º—è—Ç–∏
- –ü–æ–Ω—è—Ç—å –≥–ª—É–±–∏–Ω—É –¥–∏–∞–ª–æ–≥–æ–≤ (summaries)

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### Python –ø—Ä–∏–º–µ—Ä
```python
import httpx

# –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
auth_response = httpx.post(
    "http://localhost:8000/auth",
    json={"user_id": ADMIN_USER_ID}
)
token = auth_response.json()["access_token"]

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
headers = {"Authorization": f"Bearer {token}"}

# Overview
overview = httpx.get(
    "http://localhost:8000/admin/analytics/overview",
    headers=headers
).json()

print(f"DAU: {overview['analytics']['users']['dau']}")
print(f"MRR: {overview['analytics']['users']['premium'] * 299} RUB")
```

### JavaScript –ø—Ä–∏–º–µ—Ä
```javascript
// –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
const authRes = await fetch('http://localhost:8000/auth', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({user_id: ADMIN_USER_ID})
});
const {access_token} = await authRes.json();

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const analytics = await fetch(
  'http://localhost:8000/admin/analytics/overview',
  {headers: {'Authorization': `Bearer ${access_token}`}}
).json();

console.log('Total users:', analytics.analytics.users.total);
```

---

## üìà –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è:
- **Overview, Users, Messages, Features:** 5 –º–∏–Ω—É—Ç
- **Revenue:** 10 –º–∏–Ω—É—Ç

**–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞:**
```python
from utils.cache import invalidate_pattern

# –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
await invalidate_pattern("analytics_*")

# –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫—ç—à
await invalidate_pattern("analytics_overview*")
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **TODO:** –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –°–µ–π—á–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JWT —Ç–æ–∫–µ–Ω–∞
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å role-based access control

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –¢—è–∂–µ–ª—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è
- –õ–∏–º–∏—Ç: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≥—Ä–µ–≥–∞—Ü–∏—é –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞

### –¢–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã —Å —É—á–µ—Ç–æ–º TTL –∫—ç—à–∞
- –î–ª—è real-time –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Prometheus –º–µ—Ç—Ä–∏–∫–∏
- –î–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üé® Dashboard UI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π dashboard —Å –ø–æ–º–æ—â—å—é:
- **Grafana** - –≥–æ—Ç–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è Prometheus
- **Streamlit** - –±—ã—Å—Ç—Ä—ã–π Python UI
- **React Admin** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞
- **Custom HTML** - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

### –ü—Ä–∏–º–µ—Ä —Å Chart.js
```html
<canvas id="userChart"></canvas>
<script>
fetch('/admin/analytics/users', {
  headers: {'Authorization': 'Bearer ' + token}
})
.then(r => r.json())
.then(data => {
  new Chart(document.getElementById('userChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(data.analytics.levels_distribution),
      datasets: [{
        label: 'Users by Level',
        data: Object.values(data.analytics.levels_distribution)
      }]
    }
  });
});
</script>
```

---

## üìö –°–º. —Ç–∞–∫–∂–µ

- [SCALABILITY_IMPROVEMENTS.md](SCALABILITY_IMPROVEMENTS.md) - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [README.md](README.md) - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Prometheus Metrics](http://localhost:8000/metrics) - Real-time –º–µ—Ç—Ä–∏–∫–∏

---

---

## üî• 6. Cohort - –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### Endpoint
```
GET /admin/analytics/cohort?days=30
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- Retention –ø–æ –¥–Ω—è–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (Day 1, Day 7)
- –°—Ä–µ–¥–Ω–∏–π retention –ø–æ –≤—Å–µ–º –∫–æ–≥–æ—Ä—Ç–∞–º
- –ö–∞—á–µ—Å—Ç–≤–æ –∞—É–¥–∏—Ç–æ—Ä–∏–∏

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "period_days": 30,
    "cohorts": {
      "2025-01-01": {
        "cohort_size": 45,
        "day_1_active": 32,
        "day_1_retention": 71.11,
        "day_7_active": 18,
        "day_7_retention": 40.0
      }
    },
    "average_retention": {
      "day_1": 68.5,
      "day_7": 35.2
    }
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- –ü–æ–Ω—è—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –¥–∞—Ç–∞–º
- –°—Ä–∞–≤–Ω–∏—Ç—å cohorts (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–∏)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å onboarding

---

## üéØ 7. Funnel - –í–æ—Ä–æ–Ω–∫–∞ —É—Ä–æ–≤–Ω–µ–π

### Endpoint
```
GET /admin/analytics/funnel
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- Conversion rates –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ (1‚Üí2‚Üí3...)
- Bottleneck detection (–≥–¥–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç)
- –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- % conversion –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è 14

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "funnel": {
      "level_1": {
        "users": 1250,
        "conversion_from_previous": 100,
        "conversion_from_start": 100
      },
      "level_2": {
        "users": 890,
        "conversion_from_previous": 71.2,
        "conversion_from_start": 71.2
      },
      "level_5": {
        "users": 234,
        "conversion_from_previous": 58.5,
        "conversion_from_start": 18.72
      }
    },
    "insights": {
      "total_users": 1250,
      "avg_level_reached": 4.8,
      "bottleneck_level": 8,
      "bottleneck_dropoff": 67.3,
      "level_14_conversion": 2.4
    }
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ (bottleneck)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –ü–æ–Ω—è—Ç—å % –¥–æ—Å—Ç–∏–≥–∞—é—â–∏—Ö premium —É—Ä–æ–≤–Ω–µ–π

---

## üìÖ 8. Activity - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### Endpoint
```
GET /admin/analytics/activity
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ (Mon-Sun)
- –ü–∏–∫–æ–≤—ã–µ –∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ —á–∞—Å—ã
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–µ—Å—Å–∏–∏ (–º–∏–Ω—É—Ç—ã)

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "by_weekday": {
      "Monday": {
        "messages": 2134,
        "active_users": 345,
        "avg_messages_per_user": 6.18
      },
      "Friday": {
        "messages": 2897,
        "active_users": 412,
        "avg_messages_per_user": 7.03
      }
    },
    "peak_hour": 21,
    "slowest_hour": 5,
    "avg_session_minutes": 23.45
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ maintenance** - –¥–µ–ª–∞—Ç—å –≤ slowest_hour
- **–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥** - –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ peak_hour
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–Ω–∞—Ç—å –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —Ä–µ—Å—É—Ä—Å—ã

---

## üõ†Ô∏è 9. Tools - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π

### Endpoint
```
GET /admin/analytics/tools?days=7
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç
- –ù–æ–≤—ã–µ —Ñ–∞–∫—Ç—ã –ø–∞–º—è—Ç–∏ –ø–æ –¥–Ω—è–º
- –¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–∞–º—è—Ç–∏
- Power users (>5 —Ñ–∞–∫—Ç–æ–≤)

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "analytics": {
    "period_days": 7,
    "memory": {
      "new_facts_by_day": {
        "2025-01-01": 45,
        "2025-01-02": 67
      },
      "top_categories": {
        "preferences": 234,
        "family": 189,
        "work": 145
      },
      "power_users": 89
    }
  }
}
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω–æ
- –ü–æ–Ω—è—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è save_memory
- –ù–∞–π—Ç–∏ power users –¥–ª—è feedback

---

## üîú Roadmap

**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:**
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/JSON
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤ (week-over-week)
- [x] –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ ‚úÖ
- [x] Funnel analysis (—É—Ä–æ–≤–Ω–∏ 1‚Üí7‚Üí14) ‚úÖ
- [ ] –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (churn prediction)
- [ ] Alerting –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö
- [x] –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚úÖ
- [x] –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Tools ‚úÖ
